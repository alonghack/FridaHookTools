

---

## 🛠️ 安全扫描工具使用指南
---

### 📌 核心功能概览
1. **动态HOOK扫描** - 实时检测应用运行时行为  
2. **安装包静态扫描** - 深度分析APK/IPA文件安全风险  
3. **历史记录管理** - 查看历史扫描结果与设备信息  
4. **多主题系统设置** - 支持日间/夜间模式切换

---

### 🚀 功能详解与操作流程
---

#### 🔍 **动态HOOK扫描（运行时检测）**
**功能概述**：  
提供对已连接设备的实时动态扫描功能，支持 Android 和 iOS 应用（iOS 仅限非系统应用）。  

+ **核心能力**：  
    - 自动启动目标应用并执行测试场景。  
    - 支持手动操作复现特定测试场景（如异常行为、敏感操作）。  
    - 实时检测并记录应用行为（如 HOOK 调用、数据泄露）。
+ **适用场景**：  
    - 应用安全性验证（如反调试、反逆向）。  
    - 功能逻辑异常排查（如接口调用错误）。

**操作流程**：

1. **设备连接**  
    - 通过USB/WiFi连接Android/iOS设备（需开启开发者模式）  
    - 支持同时连接多设备（界面展示设备序列号与系统版本）
2. **模式配置**  
    - **HOOK SERVER模式**：需选择注入引擎（Frida/Objection）  
    - **自动化检测模式**：预设检测场景模板（隐私合规/恶意行为）
3. **目标选择**  
    - Android：支持全应用列表（含系统应用）  
    - iOS：仅显示用户级应用（需越狱设备支持系统应用检测）
4. **检测执行**  
    - 自动启动目标应用（或手动指定启动Activity）  
    - 实时展示HOOK日志（支持关键词过滤与高亮标记）  
    - **操作提示**：触发敏感行为后需手动标记时间节点
5. **报告生成**  
    - 支持导出PDF/JSON格式报告  
    - 自动关联风险行为与CWE/OWASP分类  
    - 示例报告截图：  
![](https://cdn.nlark.com/yuque/0/2025/png/25703151/1747308455518-f3c30cd5-e976-4fc2-b025-dac1f83824d2.png)

---

#### 📦 **安装包静态扫描（离线分析）**
**支持平台**：Android APK / iOS IPA / 鸿蒙HAP  
**技术特性**：  

+ 多引擎扫描（AndroGuard+Radare2+自定义规则）  
+ 自动提取元数据（证书/权限/组件暴露）

**功能概述**：  
支持对鸿蒙 OS/Android/iOS 安装包的静态分析，检测潜在安全风险。  

+ **核心能力**：  
    - 多平台兼容性（鸿蒙、Android、iOS）。  
    - 深度扫描（如敏感 API 调用、硬编码密钥）。  
    - 生成可导出的检测报告（支持自定义保存路径）。
+ **注意事项**：  
    - Android 扫描耗时较长，需确保设备内存充足（建议至少 8GB RAM）。  
    - 检测日志默认存储路径：`SecurityTools_internal\temp\wen_folder\queue_data.jsonl`（可手动清理以释放空间）。

**操作流程**：

1. **文件选择**  
2. 支持拖拽上传或文件浏览器选择  
3. 自动识别文件类型与版本信息
4. **扫描执行**  
5. **内存优化机制**：  
    - 大文件分块处理（>500MB自动启用）  
    - 实时进度显示与内存占用监控
+ **日志管理**：  
    - 持久化日志路径：`SecurityTools_internal/temp/wen_folder/queue_data.jsonl`  
    - 异常中断后支持断点续扫
7. **结果处理**  
    - 风险等级分级（高危/中危/低危）  
    - 支持与历史扫描结果对比分析  
    - 示例扫描界面：  
![](https://cdn.nlark.com/yuque/0/2025/png/25703151/1747308542759-bde3a351-21ae-4953-9fe6-cf9fe6ca2aa8.png)

---

#### 📚 **扫描历史管理**
**功能概述**：  
记录所有测试过的应用及设备类型，便于追溯和复盘。  

+ **核心能力**：  
    - 设备与应用信息关联（如设备型号、操作系统版本）。  
    - 快速刷新列表（切换测试场景）。  
    - 清理输出面板内容（避免干扰后续操作）

**功能亮点**：

+ 时间轴视图展示检测记录  
+ 支持按条件筛选（设备类型/风险等级/扫描日期）  
+ 快速跳转原始报告与日志文件  
+ 历史记录界面示例：  
![](https://cdn.nlark.com/yuque/0/2025/png/25703151/1747308753899-35b8e7b8-e6fe-4ebc-965d-12aaf64ae99d.png)

---

#### ⚙️ **系统设置**
**主题模式**：

+ **日间模式**：浅色主题（默认）  
+ **夜间模式**：深色主题（降低视觉疲劳）  
+ **扩展主题**：开发中（未来支持自定义配色）

**功能概述**：  
提供个性化界面配置选项，提升用户体验。  

+ **核心能力**：  
    - 主题切换（白天模式/夜间模式/其他颜色主题）。  
    - 界面优化（减少视觉疲劳，适应不同环境）

**其他配置**：

+ 日志保存路径自定义  
+ 风险规则库在线更新  
+ 多语言支持（当前仅中/英文）  
+ 设置界面示例：  
![](https://cdn.nlark.com/yuque/0/2025/png/25703151/1747308794216-9803016a-5487-43bd-a059-7a187105b2ad.png)

---

### 🚨 注意事项
1. **内存管理**  
    - 静态扫描建议预留8GB以上可用内存  
    - 检测卡顿时可尝试清理临时文件（`temp/wen_folder`）
2. **设备兼容性**  
    - iOS动态检测需关闭SIP（越狱设备）  
    - 鸿蒙HAP扫描需安装配套解析插件
3. **数据安全**  
    - 本地扫描数据加密存储（AES-256）  
    - 支持一键清除所有历史记录

---

## 项目技术栈总结
---

### 1. 动态行为检测（Runtime Analysis）
+ **核心工具**：  
    - **Frida**：通过注入JavaScript脚本实现运行时HOOK，监控API调用、网络请求、数据加解密等敏感行为。  
    - **Objection**（可选）：基于Frida的自动化测试框架，支持快速定位隐私合规问题（如位置获取、通讯录读取）。
+ **实现细节**：  
    - **跨平台支持**：Android/iOS 动态插桩，监控运行时行为（API调用、内存操作、网络请求）。  
    - **注入机制**：    
        * **Android**：通过ADB连接设备，使用`frida-gadget` 或 `frida-server` 注入目标进程。  
        * **iOS**：依赖越狱设备或开发者证书，通过`pymobiledevice3`管理连接，使用 Frida-server 注入目标进程。  
    - **脚本管理**：JavaScript/Python 脚本动态加载，支持实时HOOK与事件回调。
    - **多进程通信**：`multiprocessing.Queue`协调HOOK事件收集与前端展示，结合持久化队列（`<font style="color:#000000;">multiprocessing.queues.Queue扩展</font>`）防止数据丢失。
    - **持久化日志**：使用<font style="color:rgb(64, 64, 64);">轻量级数据存储（SQLite/JSON）、结合 </font>`<font style="color:rgb(64, 64, 64);">FileLock</font>`<font style="color:rgb(64, 64, 64);"> 确保并发写入或读取安全。</font>

---

### 2. 静态代码分析（Static Analysis）
+ **核心工具**：  
    - **Androguard**：解析APK/DEX文件，提取权限、组件暴露、恶意代码模式，支持Smali反编译与CFG生成。  
    - **Radare2**（扩展中）：深度分析二进制文件，检测Native层漏洞（如堆溢出、符号暴露）。  
    - **build-tools-windows\lib\d8.jar**：<font style="color:#000000;">使用 d8 工具将 JAR 转换为 DEX 文件</font>，优化反编译流程。增加对JAR文件分析支持，支持多版本兼容性。
    - **iOS二进制分析：**<font style="color:#000000;">解析 Info.plist，记录权限声明状态，分析二进制文件中的接口调用痕迹，提取二进制文件字符串。</font>
+ **实现细节**：  
    - **大文件处理**：  
        * 分块加载APK/DEX/JAR/IPA文件，以及日志持久化，避免内存溢出，结果内容丢失。
        * 使用`multiprocessing`后台进程执行扫描，前端通过队列接收进度通知。
    - **规则引擎**（扩展中）：自定义YAML规则库，匹配OWASP TOP 10漏洞模式（如硬编码密钥、不安全的HTTP请求）。 
    - **报告生成**：扫描结果存储为结构化JSON，路径通过 `pathlib.Path` 动态生成。 <font style="color:rgb(64, 64, 64);">结合 </font>`<font style="color:rgb(64, 64, 64);">原子化操作</font>`<font style="color:rgb(64, 64, 64);"> 确保并发写入或读取安全。</font> 

---

### 3. 用户界面（GUI）
+ **核心框架**：  
    - **Flet**：基于Flutter的Python GUI框架，实现跨平台（Windows/macOS/Linux）统一界面。
+ **核心功能**：  
    - **设备管理**：实时展示已连接设备列表（Android/iOS），支持设备筛选与操作（如强制停止应用）。    
    - **任务控制**：通过按钮触发动态/静态扫描，任务状态通过队列同步更新。  
    - **主题系统**：日间/夜间模式切换，主题配置持久化存储至SQLite。  
    - **交互设计**：  
        * 上传安装包文件，实时解析元数据（包名、版本、签名）。 
        * 动态日志面板，<font style="color:#117CEE;">支持关键词高亮与过滤（正则表达式）（扩展中）</font>。

---

### 4. 数据存储与管理
+ **数据库**：  
    - **SQLite**：存储扫描历史记录、用户配置、规则库缓存。  
    - **表结构设计**：  
        * `historical`：记录时间、检测类型、设备类型、应用名称。  
        * `allocation`：主题设置、规则库版本。
+ **队列系统**：  
    - **multiprocessing.Queue**：用于前后端进程间通信（如任务状态、日志传递）。  
    - **持久化扩展**：基于`multiprocessing.Queue`以及`FileLock` 和JSON 进行持久化扩展，确保异常中断后的恢复。

---

### 5. 构建与部署
+ **构建工具链**：  
    - **PyInstaller**：打包Python应用为独立可执行文件，处理跨平台依赖。  
    - **GitHub Actions**（可选）：自动化构建与发布流程，生成多平台安装包。
+ **依赖管理**：  
    - **Poetry**：管理Python包依赖，隔离开发环境。  
    - **Docker**（扩展中）：提供标准化测试环境，避免本地配置冲突。

---

### 6. 跨平台设备管理
+ **Android**：  
    - **ADB命令封装**：通过`adbutils`库实现设备连接、应用安装/卸载、日志抓取。
+ **iOS**：  
    - **pymobiledevice3**：管理iOS设备连接，获取应用列表（Bundle ID），支持基础调试操作。  
    - **越狱设备扩展**：可通过SSH执行高级命令（如进程终止、文件系统访问等）。

---

### 7. 安全与性能优化
+ **数据加密**：  
    - 使用AES-256加密敏感扫描结果（如密钥、用户数据）。
+ **内存管理**：  
    - 静态扫描启用内存分块机制，监控内存占用并动态释放资源。  
    - 后台服务（如日志写入）使用独立进程，避免阻塞主线程。

---

### **总结**
SecurityTools 技术栈以 **模块化** 和 **跨平台** 为核心，整合动态检测（Frida）、静态分析（Androguard）、轻量级数据存储（SQLite/JSON）、可靠队列（multiprocessing.Queue + FileLock）和现代化GUI（Flet），形成高效、可扩展的移动应用安全分析工具。其核心优势包括：  

1. **灵活的任务调度**：通过队列系统协调多进程任务。  
2. **高可靠性**：文件锁与持久化机制确保数据完整。  
3. **易用性**：Flet提供直观的跨平台界面，降低用户操作门槛。  
4. **扩展性**：模块化设计支持快速集成新检测规则或分析引擎。



---

### 📥 获取支持
+ **问题反馈**：提交GitHub Issue（附日志与截图）  
+ **社区交流**：加入Telegram/Discord开发者群组

---

> 持续更新中 · 版本号：v0.1.0  
最后更新时间：2025年5月15日
>



